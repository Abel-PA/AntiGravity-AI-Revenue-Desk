# Export Leads to Google Sheets

## Goal
Consolidate enriched lead data from various categories and export them to a Google Sheet for CRM management and outreach tracking. Handle category de-duplication and combination labeling (e.g., "HVAC & Plumbing").

## Inputs
- **Enriched Lead Files**: Text files generated by `enrich_leads.py` (e.g., `.tmp/harrisburg_hvac_enriched.txt`).
- **Google Credentials**: `credentials.json` file in the root directory (OAuth 2.0 Client ID).
- **Spreadsheet ID** (Optional): Target an existing sheet. If omitted, create a new one.

## Tools/Scripts
- `execution/export_to_sheets.py` - Consolidates data and interacts with Google Sheets API.

## Outputs
- **Google Sheet**: A structured spreadsheet with the following columns:
  - Name
  - Category (Roofing, HVAC, Plumbing, or Combination)
  - Lead Score (1-5)
  - Website
  - Phone
  - Email
  - Facebook Link
  - Instagram Link
  - TikTok Link
  - LinkedIn Link
  - X Link
  - Enriched At (Timestamp)

## De-duplication Logic
If a company appears in multiple category lists (e.g., "HL Bowman" in HVAC and Plumbing):
1. Combine the categories into a single label (e.g., "HVAC, Plumbing").
2. Retain the highest score found.
3. Ensure contact info is merged if discrepancies exist (prefer most complete).

## Process Flow
1. Parse multiple enriched lead files.
2. Build a unified dictionary of businesses keyed by Name/Website.
3. Authenticate with Google API (creates `token.json` on first run).
4. Create or clear the spreadsheet.
5. Write headers and rows.
6. Format the sheet for readability (Freeze header, Auto-size columns).

## Edge Cases
- **API Quota**: Google has limits on write requests per minute.
  - Solution: Use batch updates for writing rows.
- **Authentication Failure**: Graceful error message directing user to setup `credentials.json`.
- **Large Data Sets**: Use `values().update()` for efficiency.
- **Special Characters**: Ensure UTF-8 encoding is handled.

## Notes
- Requires a `credentials.json` file from the Google Cloud Console.
- The first run will open a browser window for user authentication.
- Scored leads (4-5) should be highlighted or sorted to the top.
